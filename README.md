# cisco2checkpoint migration tool

Cisco to Checkpoint is a conversion tool used during migration projects. It was
built to run on Linux but it should run on Windows. It supports IOS and ASA syntax as input files and generate a dbedit syntax files as output.

The tool require Python 2.7 and a forked version of [ciscoconfparse](https://pypi.python.org/pypi/ciscoconfparse) (included).

## Table of Contents

* [cisco2checkpoint migration tool](#cisco2checkpoint-migration-tool)
    * [Features](#features)
    * [Where do we start?](#where-do-we-start)
        * [Step 1: Prepare](#step-1-prepare)
            * [Migration type](#migration-type)
            * [Review config file](#review-config-file)
        * [Step 2: Convert](#step-2-convert)
            * [Conversion: Clean install](#conversion-clean-install)
            * [Conversion: Existing install](#conversion-existing-install)
        * [Step 3: Import](#step-3-import)
        * [Step 4: Verify](#step-4-verify)
        * [Step 5: Fix](#step-5-fix)
* [Help](#help)
* [Other features](#other-features)
* [Known limitations](#known-limitations)
* [Warning](#warning)
* [License](#license)

## Features

The tool supports:

- most relevant object definitions for Checkpoint: *name*, *object*, *object-group*;
- ACL: *access-list* and *ip access-list*;
- most checkpoint services: *TCP/IP*, *UDP/IP*, *ICMP*, *OSPF*, *ESP*, *AH*, *AHP*, *VRRP*, *SKIP*, *GRE*;
- flattening of *DM_INLINE* groups generated by cisco webui;
- reuse of already existing objects;
- firewall rules rationalization.

## Where do we start?

Here is a suggested process:

1. Prepare
2. Convert
3. Import
4. Verify
5. Fix

### Step 1: Prepare

The converter run offline so the user must first retrieve a copy of the running configuration. Run the `show run` command and copy its output in the root of repository.

To begin, the user should make a quick analysis of the target firewall. Here are some element to take care:

1. Policy Package: Determine a policy package in which the firewall rules will be imported. It must be created before import.
2. Firewall Object: The firewall must already exist and be known by the script.
3. Migration type: Clean install VS Existing Install. (See below)

#### Migration type

** Clean Install: ** This is the easiest type of migration. The import will be performed on a new SmartCenter with no (or very few) objects and firewall rules.

** Existing Install: ** This imply some additional activities to retrieve the list of existing network and service objects.

#### Review config file

Config file is located in `./config.py`. 95% of the users shouldn't need to modify it is worth knowing the existence of this file. User will find object prefix for dynamically created objects, excluded checkpoint services, illegal expressions replacements and association tables for ports and protocols.

### Step 2: Convert

#### Conversion: Clean install

The easiest and most basic way to convert a cisco configuration file is as follow.

```
python2.7 c2c.py --ciscoFile 'some_cisco_conf.txt'
    --syntax asa
    --export
    --policy My_Policy
    --installOn My_Firewall
    --output 'network_script.txt'
```

As a result, the file `network_script.txt` is created and contains the converted result.

#### Conversion: Existing install

To convert a configuration using an already existing SmartCenter configuration, two xml files must be exported and added as arguments to the script.

First run the following on the SmartCenter.

```
echo "printxml network_objects" > printxml_netobj.txt
echo "printxml services" > printxml_services.txt
echo '<a>' > customer_network_objects.xml
dbedit -local -f printxml_netobj.txt >> customer_network_objects.xml
echo '</a>' >> customer_network_objects.xml
echo '<a>' > customer_service_objects.xml
dbedit -local -f printxml_services.txt >> customer_service_objects.xml
echo '</a>' >> customer_service_objects.xml
```

Then copy both xml files in the root of the repository and run as follow.

```
python2.7 c2c.py --ciscoFile 'some_cisco_conf.txt'
	--cpPortsFile 'customer_service_objects.xml'
    --cpNetObjFile 'customer_network_objects.xml'
    --syntax asa
    --export
    --policy My_Policy
    --installOn My_Firewall
    --output 'network_script.txt'
```

### Step 3: Import

Before import, make sure no "write mode" session is opened with SmartDashboard. Also make sure that there is **no empty lines** and that the return characters are **\n** (not \r\n). Then run:

    dbedit -local -f network_script.txt


### Step 4: Verify


```
python2.7 c2c.py --ciscoFile 'some_cisco_conf.txt'
    --syntax asa
    --verify
    --policy My_Policy
    --installOn My_Firewall
    --output 'network_script_verify.txt'
```

### Step 5: Fix

Now that a lot of time was saved by massively importing objects and firewall rules, the user should review  imported rules manually to ensure they make sense.

Depending on the number of access list that were imported, and their assignation to interfaces, chances are high that the policy will not compile unless this step is completed.


## Help
```
usage: c2c.py [-h] [-v] [--debug] [--summary] [--export] [--verify]
              [--search TEXT] [--ciscoFile FILE] [--ciscoDir DIR]
              [--cpPortsFile FILE] [--cpNetObjFile FILE] [--syntax SYNTAX]
              [--format FORMAT] [--output FILE] [--filter CLASS] [--stdout]
              [--policy POLICY] [--installOn FWs] [--natInstallOn FW]
              [--color COLOR] [--force-log] [--startIndex INDEX]
              [--disableRules] [--flattenInlineNetGroups]
              [--flattenInlineSvcGroups]

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit
  --debug               Run the tool in debug mode

Action:
  Select one of these action

  --summary, -u         Print a summary of what is parsed and what would be
                        migrated.
  --export, -e          Export configuration. Use --format to determine
                        format.
  --verify              Export configuration like --export but in text format
                        and in a verifyable format.
  --search TEXT, -s TEXT
                        Search for a specific object.

Import config:
  --ciscoFile FILE, -c FILE
                        Cisco config file to parse.
  --ciscoDir DIR, -d DIR
                        config directory to parse. Will read only *.Config
                        files
  --cpPortsFile FILE    Checkpoint xml port file to parse. Default:
                        cp/services_objects.xml
  --cpNetObjFile FILE   Checkpoint xml network objects file to parse. Default:
                        cp/network_objects.xml
  --syntax SYNTAX       Specify the cisco syntax. Valid values: ios, asa.
                        Default: ios

Options:
  --format FORMAT, -f FORMAT
                        Specify the format. Valid values: dbedit, text.
                        Default: dbedit
  --output FILE, -o FILE
                        Output file. Default: network_script.txt
  --filter CLASS        Filter a class name, e.g. CiscoHost, CiscoPort,
                        CiscoFwRule. Can use option several times.
  --stdout              Print output to stdout.

Export Modifiers:
  --policy POLICY       The policy name. Relevant with --export only. Default:
                        Standard
  --installOn FWs       Specify the checkpoint object to install rules on.
  --natInstallOn FW     The firewall to use for all hide and static NAT rules.
  --color COLOR         The color to use for new objects.
  --force-log           Force track=Log on all firewall rules
  --startIndex INDEX    Index to start importing firewall rules. Default: 0
  --disableRules        Disable all firewall rules.
  --flattenInlineNetGroups
                        Flatten groups with prefix DM_INLINE_NETWORK_ so
                        members are added to firewall rules instead of the
                        group.
  --flattenInlineSvcGroups
                        Flatten groups with prefix DM_INLINE_SERVICE_ so
                        members are added to firewall rules instead of the
                        group.

```

## Other features

Print a summary of what is parsed

    ./cisco2checkpoint.py --ciscoFile 'cisco-run-conf.txt' --summary

Search some objects

    ./cisco2checkpoint.py --ciscoFile 'cisco-run-conf.txt' --search 'myLAN' --format text --filter CiscoHost

Export in a human readable form

    ./cisco2checkpoint.py --ciscoFile 'cisco-run-conf.txt' --export --format text

Export in a human verifyable form

    ./cisco2checkpoint.py --ciscoFile 'cisco-run-conf.txt' --verify --format text


## Known limitations

- The script convert "permit" to "allow" and "deny" to "deny". The script does generate rules with "reject" or checkpoint proprietary actions.
- The script support only None and Log tracking.
- The script does not feed the "VPN" field.
- The NAT rule translation is buggy.
- The script does not support IPv6 (so any4 or any6 become any)
- Redundant groups are not merged yet


## Warning

** Layer 2 vs Layer 3 : ** As some of you may know, Checkpoint policy is layer 3 based, meaning that firewall interfaces are completely abstracted from the policy. In fact, it is not possible to assign a rule to an interface like Cisco do. As of this writing, manual review must be performed after import.

** Cisco syntax : ** Cisco tends to be very flexible when it's time to write a line allow one to define an object in multiple ways. This lead to a lot of parsing fun (see class ASAACLLine in `./lib/ciscoconfparse/models_asa.py` for an example. This has lead to a lot of troubleshooting and patches. 

** ASA vs IOS : ** ASA and IOS have different syntaxes, which also lead to more complexe and potentially buggy code. Use at your own risk.


## License

TBD
